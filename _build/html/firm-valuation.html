
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Firm Valuation &#8212; Machine Learning in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=1a96265c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=c72506b3" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=1a96265c" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/styles/bootstrap.css?v=5340d9b1" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/styles/theme.css?v=a243ae73" />
    <link rel="stylesheet" type="text/css" href="_static/vendor/fontawesome/6.5.1/css/all.min.css?v=c786f70d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-NK1GQ8CXSN"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-NK1GQ8CXSN');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-NK1GQ8CXSN');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'firm-valuation';</script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/copybutton_funcs.js?v=776a791e"></script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/language_data.js?v=e49ba422"></script>
    <script src="_static/searchtools.js?v=d19c4805"></script>
    <script src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/scripts/bootstrap.js?v=3d67b3b1"></script>
    <script src="_static/scripts/pydata-sphinx-theme.js?v=b2908668"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?v=95180707"></script>
    <link rel="canonical" href="https://mikenguyen13.github.io/mlpy/firm-valuation.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Credit Adjustment" href="credit-adjustment.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Machine Learning in Python - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Machine Learning in Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Machine Learning in Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="_optimization.html">Optimization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Industry Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="3-approximate-nearest-neighbors.html">Approximate Nearest Neighbors</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-credit-score.html">Credit Score Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="sim_dat_bandits.html">Multi-Armed Bandits</a></li>
<li class="toctree-l1"><a class="reference internal" href="credit-approval.html">Credit Approval</a></li>
<li class="toctree-l1"><a class="reference internal" href="credit-adjustment.html">Credit Adjustment</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Firm Valuation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mikenguyen13/mlpy" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mikenguyen13/mlpy/edit/main/firm-valuation.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mikenguyen13/mlpy/issues/new?title=Issue%20on%20page%20%2Ffirm-valuation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/firm-valuation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Firm Valuation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparable-company-analysis-market-multiples">1. Comparable Company Analysis (Market Multiples)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discounted-cash-flow-dcf-analysis">2. Discounted Cash Flow (DCF) Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#precedent-transactions-analysis">3. Precedent Transactions Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asset-based-valuation">4. Asset-Based Valuation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#earnings-capitalization-method">5. Earnings Capitalization Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#private-equity-valuation">6. Private Equity Valuation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rule-of-thumb-valuations">7. Rule of Thumb Valuations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consider-adjustments-for-private-firms">Consider Adjustments for Private Firms:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application">Application</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-components">Model Components</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lstm-for-time-series-data">LSTM for Time Series Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gnn-with-time-series">GNN with Time Series</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-caps-for-constraints">Compute Caps for Constraints</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-gnn-with-time-series-modified">Training the GNN with Time Series (Modified)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-validation">Model Validation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-loss-over-epochs">Plot Loss over Epochs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm-with-quantile-regression">LightGBM with Quantile Regression</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-constraints-adjusted">Applying Constraints (Adjusted)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#liquidity-discount-and-control-premium-adjustments">Liquidity Discount and Control Premium Adjustments</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#final-output">Final Output</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#possible-improvements">Possible Improvements</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="firm-valuation">
<h1>Firm Valuation<a class="headerlink" href="#firm-valuation" title="Link to this heading">#</a></h1>
<p>Valuing a private firm can be more challenging than valuing a public firm due to the lack of readily available financial data, but there are several established methods that can help you arrive at a reasonable estimate. Here are some common approaches
Finance Perspective::</p>
<section id="comparable-company-analysis-market-multiples">
<h2>1. Comparable Company Analysis (Market Multiples)<a class="headerlink" href="#comparable-company-analysis-market-multiples" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: Identify similar publicly traded companies and apply their valuation multiples (e.g., Price/Earnings, Price/Sales, or EV/EBITDA) to the private company.</p></li>
<li><p><strong>Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Find public firms that operate in the same industry, have similar business models, and are of comparable size.</p></li>
<li><p>Calculate the valuation multiples for these public firms (e.g., Enterprise Value/EBITDA, Price/Earnings ratio).</p></li>
<li><p>Apply these multiples to the private firm’s financial metrics (e.g., earnings, sales).</p></li>
<li><p>Adjust for differences in size, growth prospects, and risk between the private and public firms.</p></li>
</ol>
</li>
<li><p><strong>Challenges</strong>: Adjustments for liquidity and size are often required, as private firms are typically riskier and less liquid than publfirms.</p></li>
</ul>
</section>
<section id="discounted-cash-flow-dcf-analysis">
<h2>2. Discounted Cash Flow (DCF) Analysis<a class="headerlink" href="#discounted-cash-flow-dcf-analysis" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: Estimate the future free cash flows of the company and discount them to present value using an appropriate discount rate (often the firm’s weighted average cost of capital, or WACC).</p></li>
<li><p><strong>Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Forecast the firm’s free cash flows (FCF) for a certain period (usually 5-10 years).</p></li>
<li><p>Estimate the terminal value, which represents the value of the firm beyond the forecast period.</p></li>
<li><p>Discount the projected cash flows and terminal value back to present value using the discount rate (WACC).</p></li>
<li><p>Adjust for any debt or excess cash to arrive at an equity valuation.</p></li>
</ol>
</li>
<li><p><strong>Challenges</strong>: Requires detailed financial projections and a reliable discount rate. The assumptions about growth rates and discount rates can significantly imp the valuation.</p></li>
</ul>
</section>
<section id="precedent-transactions-analysis">
<h2>3. Precedent Transactions Analysis<a class="headerlink" href="#precedent-transactions-analysis" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: Look at the prices paid for similar companies in recent transactions (mergers and acquisitions) and apply those multiples to the private firm.</p></li>
<li><p><strong>Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Identify recent transactions of similar firms in the same industry.</p></li>
<li><p>Extract valuation multiples from these transactions (e.g., EV/EBITDA, EV/Sales).</p></li>
<li><p>Apply these multiples to the private firm’s financials to estimate its value.</p></li>
</ol>
</li>
<li><p><strong>Challenges</strong>: Finding truly comparable transactions and adjusting for timing differences, as market conditions may have changednce those transactions.</p></li>
</ul>
</section>
<section id="asset-based-valuation">
<h2>4. Asset-Based Valuation<a class="headerlink" href="#asset-based-valuation" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: Value the company based on the net value of its assets (assets minus liabilities).</p></li>
<li><p><strong>Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Sum up the fair market value of all the company’s tangible and intangible assets.</p></li>
<li><p>Subtract any liabilities to determine the net asset value.</p></li>
</ol>
</li>
<li><p><strong>Challenges</strong>: This method works well for asset-heavy firms but may undervalue firms with significant intangible assets (e.g., intectual property, brand value).</p></li>
</ul>
</section>
<section id="earnings-capitalization-method">
<h2>5. Earnings Capitalization Method<a class="headerlink" href="#earnings-capitalization-method" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: Use a company’s historical earnings and capitalize them at a rate that reflects the risk of the business.</p></li>
<li><p><strong>Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Determine the firm’s normalized earnings (e.g., after adjusting for non-recurring events).</p></li>
<li><p>Select an appropriate capitalization rate based on the firm’s risk profile.</p></li>
<li><p>Value the firm by dividing normalized earnings by the capitalization rate.</p></li>
</ol>
</li>
<li><p><strong>Challenges</strong>: This method is more static andy not reflect future growth prospects.</p></li>
</ul>
</section>
<section id="private-equity-valuation">
<h2>6. Private Equity Valuation<a class="headerlink" href="#private-equity-valuation" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: Use private equity benchmarks, considering factors such as control premiums, illiquidity discounts, and expected returns that private equity investors would demand.</p></li>
<li><p><strong>Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Estimate future cash flows or earnings.</p></li>
<li><p>Apply typical private equity valuation multiples or expected rates of return (IRR) from similar investments.</p></li>
</ol>
</li>
<li><p><strong>Challenges</strong>: Access data on private equity deals can be limited.</p></li>
</ul>
</section>
<section id="rule-of-thumb-valuations">
<h2>7. Rule of Thumb Valuations<a class="headerlink" href="#rule-of-thumb-valuations" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Process</strong>: In some industries, companies are valued based on specific industry rules of thumb (e.g., X times revenue or X times EBITDA).</p></li>
<li><p><strong>Steps</strong>: Find common valuation benchmarks in the industry and apply them to your firm.</p></li>
<li><p><strong>Challenges</strong>: These are simplistic and do account for the nuances of individual businesses.</p></li>
</ul>
</section>
<section id="consider-adjustments-for-private-firms">
<h2>Consider Adjustments for Private Firms:<a class="headerlink" href="#consider-adjustments-for-private-firms" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Liquidity Discount</strong>: Since private firms are harder to sell, a liquidity discount of 10-30% is often applied to the valuation.</p></li>
<li><p><strong>Control Premium</strong>: If you are valuing a controlling stake, add a control premium (10-40%) to reflect the added value of control.</p></li>
<li><p><strong>Size Premium</strong>: Smaller firms tend to carry higher n, a combination of methods gives the most comprehensive estimate.</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Company</p></th>
<th class="head"><p>Start Year</p></th>
<th class="head"><p>End Year</p></th>
<th class="head"><p>Valuation Growth (%)</p></th>
<th class="head"><p>Key Factors</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Tesla</p></td>
<td><p>2019</p></td>
<td><p>2020</p></td>
<td><p>740%</p></td>
<td><p>Strong sales, stock splits, and investor optimism in electric vehicles and renewable energy</p></td>
</tr>
<tr class="row-odd"><td><p>Apple</p></td>
<td><p>2019</p></td>
<td><p>2020</p></td>
<td><p>85%</p></td>
<td><p>Record-breaking iPhone sales, growth in services, and investor confidence</p></td>
</tr>
<tr class="row-even"><td><p>Zoom</p></td>
<td><p>2019</p></td>
<td><p>2020</p></td>
<td><p>425%</p></td>
<td><p>Increased demand for video conferencing due to COVID-19 pandemic and remote work trends</p></td>
</tr>
<tr class="row-odd"><td><p>NVIDIA</p></td>
<td><p>2015</p></td>
<td><p>2016</p></td>
<td><p>224%</p></td>
<td><p>High demand for GPUs in gaming, artificial intelligence (AI), and cryptocurrency mining</p></td>
</tr>
<tr class="row-even"><td><p>Moderna</p></td>
<td><p>2019</p></td>
<td><p>2020</p></td>
<td><p>434%</p></td>
<td><p>Successful progress in COVID-19 vaccine development and mRNA technology</p></td>
</tr>
<tr class="row-odd"><td><p>Amazon</p></td>
<td><p>1998</p></td>
<td><p>1999</p></td>
<td><p>1,500%</p></td>
<td><p>Expansion of e-commerce during the dot-com boom</p></td>
</tr>
<tr class="row-even"><td><p>Beyond Meat</p></td>
<td><p>2018</p></td>
<td><p>2019</p></td>
<td><p>200%</p></td>
<td><p>Rapid consumer adoption of plant-based diets and partnerships with fast-food chains and retailers</p></td>
</tr>
<tr class="row-odd"><td><p>Alibaba</p></td>
<td><p>2013</p></td>
<td><p>2014</p></td>
<td><p>37%</p></td>
<td><p>Successful IPO and growth in e-commerce and digital payments in China</p></td>
</tr>
</tbody>
</table>
</section>
<section id="application">
<h2>Application<a class="headerlink" href="#application" title="Link to this heading">#</a></h2>
<p><strong>Goal</strong>: You are developing a valuation model for private firms using a combination of Graph Neural Networks (GNNs), Long Short-Term Memory networks (LSTMs), and Quantile Regression with LightGBM. The model aims to predict the valuations of private firms based on their features, historical data, and relationships with other firms in the same industry, while adhering to certain constraints derived from public firms’ valuations.</p>
<p><strong>Approach</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Data Preparation</strong>: Simulate firm data, including time series features and industry relationships.</p></li>
<li><p><strong>Model Components</strong>: Build a neural network combining Graph Neural Networks (GNNs) and Long Short-Term Memory networks (LSTMs).</p></li>
<li><p><strong>Constraints Application</strong>: Enforce valuation caps based on public firms during training and prediction.</p></li>
<li><p><strong>Quantile Regression with LightGBM</strong>: Estimate valuation ranges using quantile regression.</p></li>
<li><p><strong>Adjustments and Final Output</strong>: Apply liquidity discounts and control premiums, and present the results.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;KMP_DUPLICATE_LIB_OK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">torch_geometric.nn</span> <span class="kn">import</span> <span class="n">GCNConv</span>
<span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="data-preparation">
<h3>Data Preparation<a class="headerlink" href="#data-preparation" title="Link to this heading">#</a></h3>
<p>Simulate a dataset that reflects real-world scenarios involving public and private firms, their industries, time series features, and inter-firm relationships.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">NUM_FIRMS</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">NUM_PUBLIC</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">NUM_INDUSTRIES</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">YEARS</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">FEATURES_PER_YEAR</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">GROWTH_CAP_MULTIPLIER</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># 1500% growth</span>

<span class="c1"># Generate firm IDs and assign industries</span>
<span class="n">firm_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NUM_FIRMS</span><span class="p">)</span>
<span class="n">industries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">NUM_INDUSTRIES</span><span class="p">),</span> <span class="n">NUM_FIRMS</span><span class="p">)</span>

<span class="c1"># Assign public/private status</span>
<span class="n">is_public</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="n">NUM_PUBLIC</span> <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">NUM_FIRMS</span> <span class="o">-</span> <span class="n">NUM_PUBLIC</span><span class="p">))</span>

<span class="c1"># Generate time series data</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># For reproducibility</span>
<span class="n">time_series_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">NUM_FIRMS</span><span class="p">,</span> <span class="n">YEARS</span><span class="p">,</span> <span class="n">FEATURES_PER_YEAR</span><span class="p">)</span>

<span class="c1"># Generate network connections within the same industry</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">firm_ids</span><span class="p">)</span>
<span class="k">for</span> <span class="n">industry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_INDUSTRIES</span><span class="p">):</span>
    <span class="n">firms_in_industry</span> <span class="o">=</span> <span class="n">firm_ids</span><span class="p">[</span><span class="n">industries</span> <span class="o">==</span> <span class="n">industry</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">firms_in_industry</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">fast_gnp_random_graph</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">firms_in_industry</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">industry</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">firms_in_industry</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">firms_in_industry</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

<span class="c1"># Create edge_index for PyTorch Geometric</span>
<span class="n">edge_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
<span class="n">edge_index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">edge_index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>

<span class="c1"># Assign valuations</span>
<span class="n">public_valuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">NUM_PUBLIC</span><span class="p">,</span> <span class="n">YEARS</span><span class="p">))</span>
<span class="n">private_valuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">NUM_FIRMS</span> <span class="o">-</span> <span class="n">NUM_PUBLIC</span><span class="p">,</span> <span class="n">YEARS</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">valuations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">public_valuations</span><span class="p">,</span> <span class="n">private_valuations</span><span class="p">])</span>

<span class="c1"># Combine features (excluding liquidity discounts and control premiums)</span>
<span class="n">combined_features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">time_series_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Firm Generation: Creates a mix of public and private firms, each assigned to an industry.</p></li>
<li><p>Time Series Data: Simulates historical features (e.g., financial metrics) for each firm.</p></li>
<li><p>Network Connections: Models relationships between firms within the same industry using a random graph.</p></li>
<li><p>Valuations: Assigns known valuations to public firms and NaN to private firms.</p></li>
<li><p>Features Combination: Prepares the data for model input, excluding user-defined factors like liquidity discounts.</p></li>
</ul>
</section>
<section id="model-components">
<h3>Model Components<a class="headerlink" href="#model-components" title="Link to this heading">#</a></h3>
<p>Define a neural network architecture that combines GNNs and LSTMs to process both relational (graph-based) and temporal (time series) data.</p>
<section id="lstm-for-time-series-data">
<h4>LSTM for Time Series Data<a class="headerlink" href="#lstm-for-time-series-data" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LSTMTimeSeries</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LSTMTimeSeries</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">lstm_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">final_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">lstm_out</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>  <span class="c1"># Last time step</span>
        <span class="k">return</span> <span class="n">final_output</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="gnn-with-time-series">
<h4>GNN with Time Series<a class="headerlink" href="#gnn-with-time-series" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GNNWithTimeSeries</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_input_dim</span><span class="p">,</span> <span class="n">graph_hidden_dim</span><span class="p">,</span> <span class="n">graph_output_dim</span><span class="p">,</span>
                 <span class="n">time_input_dim</span><span class="p">,</span> <span class="n">time_hidden_dim</span><span class="p">,</span> <span class="n">time_output_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GNNWithTimeSeries</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># GNN layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">GCNConv</span><span class="p">(</span><span class="n">graph_input_dim</span><span class="p">,</span> <span class="n">graph_hidden_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">GCNConv</span><span class="p">(</span><span class="n">graph_hidden_dim</span><span class="p">,</span> <span class="n">graph_output_dim</span><span class="p">)</span>
        
        <span class="c1"># LSTM layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">LSTMTimeSeries</span><span class="p">(</span><span class="n">time_input_dim</span><span class="p">,</span> <span class="n">time_hidden_dim</span><span class="p">,</span> <span class="n">time_output_dim</span><span class="p">)</span>
        
        <span class="c1"># Final output layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_final</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">graph_output_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_features</span><span class="p">,</span> <span class="n">time_features</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">):</span>
        <span class="c1"># GNN forward pass</span>
        <span class="n">gnn_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">graph_features</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">))</span>
        <span class="n">gnn_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">gnn_out</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">)</span>
        
        <span class="c1"># LSTM forward pass</span>
        <span class="n">lstm_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span><span class="p">(</span><span class="n">time_features</span><span class="p">)</span>
        
        <span class="c1"># Combine outputs</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">gnn_out</span> <span class="o">+</span> <span class="n">lstm_out</span>  <span class="c1"># Simple addition</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_final</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>  <span class="c1"># Scalar output</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>LSTM Network:</p>
<ul>
<li><p>Captures temporal dependencies in the time series data for each firm.</p></li>
<li><p>Outputs a representation of the firm’s historical performance.</p></li>
</ul>
</li>
<li><p>GNN Network:</p>
<ul>
<li><p>Processes graph-structured data, capturing the influence of connected firms.</p></li>
<li><p>Generates embeddings that reflect both a firm’s features and its relationships.</p></li>
</ul>
</li>
<li><p>Combination and Output:</p>
<ul>
<li><p>The outputs from the LSTM and GNN are combined.</p></li>
<li><p>A final linear layer maps the combined representation to a scalar valuation prediction.</p></li>
</ul>
</li>
</ul>
<p><strong>Rationale</strong>:
Integrated Modeling: Combining GNN and LSTM allows the model to consider both temporal trends and relational influences, providing a more comprehensive valuation estimate.</p>
</section>
<section id="compute-caps-for-constraints">
<h4>Compute Caps for Constraints<a class="headerlink" href="#compute-caps-for-constraints" title="Link to this heading">#</a></h4>
<p>Calculate industry-specific valuation caps for each firm to enforce realistic valuation predictions based on public firms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_caps</span><span class="p">(</span><span class="n">firm_ids</span><span class="p">,</span> <span class="n">industries</span><span class="p">,</span> <span class="n">valuations</span><span class="p">,</span> <span class="n">growth_cap_multiplier</span><span class="p">):</span>
    <span class="n">caps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">NUM_FIRMS</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>  <span class="c1"># Initialize with infinity</span>
    <span class="k">for</span> <span class="n">industry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_INDUSTRIES</span><span class="p">):</span>
        <span class="n">peer_vals</span> <span class="o">=</span> <span class="n">valuations</span><span class="p">[(</span><span class="n">industries</span> <span class="o">==</span> <span class="n">industry</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">is_public</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peer_vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_peer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">peer_vals</span><span class="p">)</span>
            <span class="n">cap</span> <span class="o">=</span> <span class="n">max_peer</span> <span class="o">*</span> <span class="n">growth_cap_multiplier</span>
            <span class="n">caps</span><span class="p">[</span><span class="n">industries</span> <span class="o">==</span> <span class="n">industry</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap</span>
    <span class="k">return</span> <span class="n">caps</span>

<span class="c1"># Compute caps and convert to tensor</span>
<span class="n">caps</span> <span class="o">=</span> <span class="n">compute_caps</span><span class="p">(</span><span class="n">firm_ids</span><span class="p">,</span> <span class="n">industries</span><span class="p">,</span> <span class="n">valuations</span><span class="p">,</span> <span class="n">GROWTH_CAP_MULTIPLIER</span><span class="p">)</span>
<span class="n">caps_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">caps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Caps Calculation:</p>
<ul class="simple">
<li><p>For each industry, identifies the maximum valuation among public firms.</p></li>
<li><p>Applies a growth multiplier (e.g., 1500%) to set the cap.</p></li>
<li><p>Assigns this cap to all firms within the same industry.</p></li>
</ul>
<p><strong>Rationale</strong>:
Industry-Based Constraints:</p>
<ul class="simple">
<li><p>Ensures that private firms’ valuations are within a reasonable range compared to their public peers.</p></li>
<li><p>Reflects market realities and prevents overestimation.</p></li>
</ul>
</section>
<section id="training-the-gnn-with-time-series-modified">
<h4>Training the GNN with Time Series (Modified)<a class="headerlink" href="#training-the-gnn-with-time-series-modified" title="Link to this heading">#</a></h4>
<p>Train the neural network while applying the calculated valuation caps to enforce constraints during learning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss_history</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">train_gnn_with_time_series</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">graph_features</span><span class="p">,</span> <span class="n">time_features</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">valuations</span><span class="p">,</span> <span class="n">caps_tensor</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">graph_features</span><span class="p">,</span> <span class="n">time_features</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">)</span>
        
        <span class="c1"># Apply constraints</span>
        <span class="n">min_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">caps_tensor</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">caps_tensor</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_tensor</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">caps_tensor</span><span class="p">)</span>
        
        <span class="c1"># Compute loss on public firms</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">valuations</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">caps_tensor</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        
        <span class="n">preds</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        
        <span class="n">loss_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model Initialization and Training Execution:</span>

<span class="c1"># Initialize the model</span>
<span class="n">GRAPH_INPUT_DIM</span> <span class="o">=</span> <span class="n">combined_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Number of features per node</span>
<span class="n">GRAPH_HIDDEN_DIM</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">GRAPH_OUTPUT_DIM</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">TIME_INPUT_DIM</span> <span class="o">=</span> <span class="n">FEATURES_PER_YEAR</span>
<span class="n">TIME_HIDDEN_DIM</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">TIME_OUTPUT_DIM</span> <span class="o">=</span> <span class="mi">32</span>

<span class="c1"># Device configuration</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>

<span class="c1"># Initialize the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GNNWithTimeSeries</span><span class="p">(</span>
    <span class="n">graph_input_dim</span><span class="o">=</span><span class="n">GRAPH_INPUT_DIM</span><span class="p">,</span>
    <span class="n">graph_hidden_dim</span><span class="o">=</span><span class="n">GRAPH_HIDDEN_DIM</span><span class="p">,</span>
    <span class="n">graph_output_dim</span><span class="o">=</span><span class="n">GRAPH_OUTPUT_DIM</span><span class="p">,</span>
    <span class="n">time_input_dim</span><span class="o">=</span><span class="n">TIME_INPUT_DIM</span><span class="p">,</span>
    <span class="n">time_hidden_dim</span><span class="o">=</span><span class="n">TIME_HIDDEN_DIM</span><span class="p">,</span>
    <span class="n">time_output_dim</span><span class="o">=</span><span class="n">TIME_OUTPUT_DIM</span>
<span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

<span class="c1"># Prepare features and move to device</span>
<span class="n">graph_features</span> <span class="o">=</span> <span class="n">combined_features</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">time_features</span> <span class="o">=</span> <span class="n">combined_features</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">edge_index</span> <span class="o">=</span> <span class="n">edge_index</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">caps_tensor</span> <span class="o">=</span> <span class="n">caps_tensor</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Train the model</span>
<span class="n">train_gnn_with_time_series</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="p">,</span>
    <span class="n">criterion</span><span class="p">,</span>
    <span class="n">graph_features</span><span class="p">,</span>
    <span class="n">time_features</span><span class="p">,</span>
    <span class="n">edge_index</span><span class="p">,</span>
    <span class="n">valuations</span><span class="p">,</span>
    <span class="n">caps_tensor</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/100, Loss: 98064.9062
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 20/100, Loss: 36558.7617
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 40/100, Loss: 13651.0820
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 60/100, Loss: 12079.2158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 80/100, Loss: 11743.6221
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 100/100, Loss: 11517.5195
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Applying Constraints:</p>
<ul>
<li><p>Uses torch.clamp to enforce that predictions are between 0 and the cap.</p></li>
<li><p>Ensures that the model learns to produce valuations within acceptable bounds.</p></li>
</ul>
</li>
<li><p>Loss Computation:</p>
<ul>
<li><p>Calculates loss only on public firms since their true valuations are known.</p></li>
<li><p>Uses Mean Squared Error (MSE) as the loss function.</p></li>
</ul>
</li>
<li><p>Training Loop:</p>
<ul>
<li><p>Performs forward pass, backpropagation, and optimizer step.</p></li>
<li><p>Records loss for analysis.</p></li>
</ul>
</li>
</ul>
<p><strong>Rationale</strong></p>
<ul class="simple">
<li><p>Constraint Enforcement During Training:</p>
<ul>
<li><p>Helps the model to internalize the valuation limits.</p></li>
<li><p>Leads to more realistic predictions for private firms.</p></li>
</ul>
</li>
<li><p>Focusing on Public Firms for Loss:</p>
<ul>
<li><p>Since private firms’ valuations are unknown, training on public firms prevents introducing noise from uncertain targets.</p></li>
</ul>
</li>
</ul>
</section>
<section id="model-validation">
<h4>Model Validation<a class="headerlink" href="#model-validation" title="Link to this heading">#</a></h4>
<p>Evaluate the model’s predictive performance using standard regression metrics and visualize the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get model predictions and embeddings</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">all_preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">graph_features</span><span class="p">,</span> <span class="n">time_features</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">)</span>
    
    <span class="c1"># Ensure &#39;all_preds&#39; and &#39;caps_tensor&#39; are on the same device</span>
    <span class="n">all_preds</span> <span class="o">=</span> <span class="n">all_preds</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">caps_tensor</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    
    <span class="c1"># Create &#39;min_tensor&#39; as zeros_like &#39;all_preds&#39; on the same device</span>
    <span class="n">min_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">all_preds</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">caps_tensor</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    
    <span class="c1"># Apply constraints to the output</span>
    <span class="n">all_preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">all_preds</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_tensor</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">caps_tensor</span><span class="p">)</span>
    
    <span class="n">node_embeddings</span> <span class="o">=</span> <span class="n">all_preds</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">validate_model</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">valuations</span><span class="p">):</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">valuations</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

    <span class="c1"># Evaluation metrics</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error (MAE): </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Root Mean Squared Error (RMSE): </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R-squared (R2): </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plotting Predictions vs True Values</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;True Valuations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted Valuations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicted vs True Valuations&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">target</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">target</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">target</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Validate the model</span>
<span class="n">validate_model</span><span class="p">(</span><span class="n">node_embeddings</span><span class="p">,</span> <span class="n">valuations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validation Metrics:
Mean Absolute Error (MAE): 89.8252
Root Mean Squared Error (RMSE): 107.2832
R-squared (R2): 0.1445
</pre></div>
</div>
<img alt="_images/e83168579d7681add24d0c78bf4bb48d88edc55e7028e3cc8ca93247d82a0781.png" src="_images/e83168579d7681add24d0c78bf4bb48d88edc55e7028e3cc8ca93247d82a0781.png" />
</div>
</div>
<p>Metrics Computed:</p>
<ul class="simple">
<li><p>MAE: Average absolute difference between predicted and true valuations.</p></li>
<li><p>RMSE: Square root of the average squared differences.</p></li>
<li><p>R² Score: Proportion of variance explained by the model.</p></li>
<li><p>Visualization:</p></li>
<li><p>Scatter plot of predicted vs. true valuations.</p></li>
<li><p>Diagonal line represents perfect predictions.</p></li>
</ul>
<p><strong>Rationale</strong>: Assessing Model Performance:</p>
<ul class="simple">
<li><p>Metrics provide quantitative measures of accuracy.</p></li>
<li><p>Visualization helps identify patterns, biases, or outliers.</p></li>
</ul>
</section>
<section id="plot-loss-over-epochs">
<h4>Plot Loss over Epochs<a class="headerlink" href="#plot-loss-over-epochs" title="Link to this heading">#</a></h4>
<p>Monitor the training process to ensure the model is learning effectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_loss_history</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training Loss Over Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot the loss</span>
<span class="n">plot_loss_history</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/509a98f45a2b962b313fe14de447151380d9d49ad0ed35be4f15898ac137ef1b.png" src="_images/509a98f45a2b962b313fe14de447151380d9d49ad0ed35be4f15898ac137ef1b.png" />
</div>
</div>
<p>Loss Curve:</p>
<ul class="simple">
<li><p>Displays how the loss decreases over epochs.</p></li>
<li><p>Helps identify issues like plateauing or increasing loss.</p></li>
</ul>
<p><strong>Rationale</strong>: Training Monitoring:</p>
<ul class="simple">
<li><p>Ensures that the model is converging.</p></li>
<li><p>Provides insight into whether more epochs are needed or if overfitting is occurring.</p></li>
</ul>
</section>
<section id="lightgbm-with-quantile-regression">
<h4>LightGBM with Quantile Regression<a class="headerlink" href="#lightgbm-with-quantile-regression" title="Link to this heading">#</a></h4>
<p>Estimate the lower and upper bounds of the firm’s valuation using quantile regression, providing a range rather than a single point estimate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare features for LightGBM</span>
<span class="n">X_combined</span> <span class="o">=</span> <span class="n">node_embeddings</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use model predictions as features</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">valuations</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Split into training data (public firms only)</span>
<span class="n">train_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_combined</span><span class="p">[</span><span class="n">train_mask</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_mask</span><span class="p">]</span>

<span class="c1"># Function to train LightGBM quantile model</span>
<span class="k">def</span> <span class="nf">train_lightgbm_quantile</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">quantile</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;boosting_type&#39;</span><span class="p">:</span> <span class="s1">&#39;gbdt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;quantile&#39;</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;quantile&#39;</span><span class="p">,</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">quantile</span><span class="p">,</span>
        <span class="s1">&#39;num_leaves&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="s1">&#39;feature_fraction&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">lgb_train</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">lgb_train</span><span class="p">,</span> <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="c1"># Train quantile models</span>
<span class="n">gbm_upper</span> <span class="o">=</span> <span class="n">train_lightgbm_quantile</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">quantile</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">gbm_lower</span> <span class="o">=</span> <span class="n">train_lightgbm_quantile</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">quantile</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Predict on all firms</span>
<span class="n">y_pred_upper</span> <span class="o">=</span> <span class="n">gbm_upper</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_combined</span><span class="p">)</span>
<span class="n">y_pred_lower</span> <span class="o">=</span> <span class="n">gbm_lower</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_combined</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Feature Preparation:</p>
<ul>
<li><p>Uses the neural network’s predictions as the sole feature for LightGBM.</p></li>
<li><p>Focuses on capturing the relationship between the predicted valuations and the true valuations.</p></li>
</ul>
</li>
<li><p>Quantile Regression:</p>
<ul>
<li><p>Trains two models targeting different quantiles (e.g., 10th and 90th percentiles).</p></li>
<li><p>The alpha parameter in LightGBM specifies the quantile to estimate.</p></li>
</ul>
</li>
</ul>
<p><strong>Rationale</strong>:</p>
<ul class="simple">
<li><p>Why Quantile Regression with LightGBM?</p>
<ul>
<li><p>Uncertainty Estimation:</p>
<ul>
<li><p>Provides a range for valuations, acknowledging the inherent uncertainty in predictions.</p></li>
<li><p>Helps in risk assessment by offering lower and upper bounds.</p></li>
</ul>
</li>
<li><p>Non-parametric Approach:</p>
<ul>
<li><p>LightGBM is a gradient boosting framework that can model complex nonlinear relationships without assuming a specific data distribution.</p></li>
<li><p>Suitable for capturing patterns that neural networks might have missed.</p></li>
</ul>
</li>
<li><p>Complementary to Neural Networks:</p>
<ul>
<li><p>While neural networks provide a point estimate, LightGBM quantile regression refines this estimate by learning from residual errors.</p></li>
<li><p>Leverages the strengths of both models for better prediction intervals.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Choice of LightGBM:</p>
<ul>
<li><p>Efficiency: LightGBM is known for its speed and efficiency, especially with large datasets.</p></li>
<li><p>Flexibility: Supports quantile regression out of the box, making it convenient for estimating different quantiles.</p></li>
<li><p>Handling Overfitting: Features built-in mechanisms like early stopping and regularization to prevent overfitting.</p></li>
</ul>
</li>
</ul>
</section>
<section id="applying-constraints-adjusted">
<h4>Applying Constraints (Adjusted)<a class="headerlink" href="#applying-constraints-adjusted" title="Link to this heading">#</a></h4>
<p>Ensure the LightGBM predictions adhere to the same valuation caps applied during neural network training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply constraints to LightGBM predictions</span>
<span class="n">bounded_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">y_pred_lower</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">bounded_upper</span> <span class="o">=</span> <span class="n">y_pred_upper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_FIRMS</span><span class="p">):</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">caps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">bounded_upper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bounded_upper</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cap</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Lower Bound: Ensures that the lower bound predictions are not negative.</p></li>
<li><p>Upper Bound: Caps the upper bound predictions using the previously calculated industry-specific caps.</p></li>
</ul>
<p><strong>Rationale</strong>: Consistency in Constraints:</p>
<ul class="simple">
<li><p>Maintains the integrity of the valuation estimates across different modeling stages.</p></li>
<li><p>Prevents unrealistic valuation ranges.</p></li>
</ul>
</section>
<section id="liquidity-discount-and-control-premium-adjustments">
<h4>Liquidity Discount and Control Premium Adjustments<a class="headerlink" href="#liquidity-discount-and-control-premium-adjustments" title="Link to this heading">#</a></h4>
<p>Adjust the bounded valuation ranges based on user-defined liquidity discounts and control premiums.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate liquidity discounts and control premiums</span>
<span class="n">latest_liquidity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">NUM_FIRMS</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># 20% liquidity discount</span>
<span class="n">latest_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">NUM_FIRMS</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>    <span class="c1"># 30% control premium</span>

<span class="k">def</span> <span class="nf">adjust_valuations</span><span class="p">(</span><span class="n">bounded_lower</span><span class="p">,</span> <span class="n">bounded_upper</span><span class="p">,</span> <span class="n">liquidity_discounts</span><span class="p">,</span> <span class="n">control_premiums</span><span class="p">):</span>
    <span class="n">adjusted_lower</span> <span class="o">=</span> <span class="n">bounded_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidity_discounts</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">control_premiums</span><span class="p">)</span>
    <span class="n">adjusted_upper</span> <span class="o">=</span> <span class="n">bounded_upper</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">liquidity_discounts</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">control_premiums</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adjusted_lower</span><span class="p">,</span> <span class="n">adjusted_upper</span>

<span class="c1"># Adjust valuations</span>
<span class="n">adjusted_lower</span><span class="p">,</span> <span class="n">adjusted_upper</span> <span class="o">=</span> <span class="n">adjust_valuations</span><span class="p">(</span>
    <span class="n">bounded_lower</span><span class="p">,</span>
    <span class="n">bounded_upper</span><span class="p">,</span>
    <span class="n">latest_liquidity</span><span class="p">,</span>
    <span class="n">latest_control</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Liquidity Discount:</p>
<ul>
<li><p>Reflects the reduced marketability of private firm shares.</p></li>
<li><p>Decreases the valuation to account for the difficulty in selling shares.</p></li>
</ul>
</li>
<li><p>Control Premium:</p>
<ul>
<li><p>Represents the additional value of having controlling interest.</p></li>
<li><p>Increases the valuation for majority ownership stakes.</p></li>
</ul>
</li>
<li><p>Adjustment Formula:</p>
<ul>
<li><p>Adjusted Valuation = Valuation × (1 - Liquidity Discount) × (1 + Control Premium)</p></li>
</ul>
</li>
</ul>
<p><strong>Rationale</strong></p>
<ul class="simple">
<li><p>Customization: Allows users to input values based on specific transaction conditions or market insights.</p></li>
<li><p>Realism: Incorporates factors that significantly impact firm valuations in practice.</p></li>
</ul>
</section>
<section id="final-output">
<h4>Final Output<a class="headerlink" href="#final-output" title="Link to this heading">#</a></h4>
<p>Consolidate all results and present them in an accessible format for analysis or reporting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a DataFrame to display results</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Firm_ID&#39;</span><span class="p">:</span> <span class="n">firm_ids</span><span class="p">,</span>
    <span class="s1">&#39;Industry&#39;</span><span class="p">:</span> <span class="n">industries</span><span class="p">,</span>
    <span class="s1">&#39;Is_Public&#39;</span><span class="p">:</span> <span class="n">is_public</span><span class="p">,</span>
    <span class="s1">&#39;Predicted_Lower_Bound&#39;</span><span class="p">:</span> <span class="n">y_pred_lower</span><span class="p">,</span>
    <span class="s1">&#39;Predicted_Upper_Bound&#39;</span><span class="p">:</span> <span class="n">y_pred_upper</span><span class="p">,</span>
    <span class="s1">&#39;Bounded_Lower&#39;</span><span class="p">:</span> <span class="n">bounded_lower</span><span class="p">,</span>
    <span class="s1">&#39;Bounded_Upper&#39;</span><span class="p">:</span> <span class="n">bounded_upper</span><span class="p">,</span>
    <span class="s1">&#39;Adjusted_Lower&#39;</span><span class="p">:</span> <span class="n">adjusted_lower</span><span class="p">,</span>
    <span class="s1">&#39;Adjusted_Upper&#39;</span><span class="p">:</span> <span class="n">adjusted_upper</span>
<span class="p">})</span>

<span class="c1"># Display the first 10 results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final Valuation Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final Valuation Results:
   Firm_ID  Industry  Is_Public  Predicted_Lower_Bound  Predicted_Upper_Bound  \
0        0         2       True             179.155729             452.646379   
1        1         2       True             167.643709             455.266269   
2        2         3       True             167.643709             455.266269   
3        3         2       True             152.870640             448.479663   
4        4         3       True             147.062618             458.987070   
5        5         3       True             179.474740             452.646379   
6        6         2       True             114.127490             399.494178   
7        7         0       True             179.474740             452.646379   
8        8         2       True             147.062618             458.987070   
9        9         4       True             114.127490             399.494178   

   Bounded_Lower  Bounded_Upper  Adjusted_Lower  Adjusted_Upper  
0     179.155729     452.646379      186.321958      470.752234  
1     167.643709     455.266269      174.349457      473.476920  
2     167.643709     455.266269      174.349457      473.476920  
3     152.870640     448.479663      158.985466      466.418849  
4     147.062618     458.987070      152.945123      477.346553  
5     179.474740     452.646379      186.653730      470.752234  
6     114.127490     399.494178      118.692589      415.473946  
7     179.474740     452.646379      186.653730      470.752234  
8     147.062618     458.987070      152.945123      477.346553  
9     114.127490     399.494178      118.692589      415.473946  
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="possible-improvements">
<h3>Possible Improvements<a class="headerlink" href="#possible-improvements" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Advanced Model Architectures:</p></li>
</ol>
<ul class="simple">
<li><p>Experiment with different GNN variants (e.g., Graph Attention Networks).</p></li>
<li><p>Explore more sophisticated methods of combining GNN and LSTM outputs.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Hyperparameter Optimization:</p></li>
</ol>
<ul class="simple">
<li><p>Use automated tools (e.g., Grid Search, Bayesian Optimization) to fine-tune model parameters.</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Regularization and Overfitting Prevention:</p></li>
</ol>
<ul class="simple">
<li><p>Implement dropout layers, weight decay, and early stopping techniques.</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Cross-Validation:</p></li>
</ol>
<ul class="simple">
<li><p>Employ k-fold cross-validation to assess the model’s generalization capability.</p></li>
</ul>
<ol class="arabic simple" start="5">
<li><p>Uncertainty Quantification:</p></li>
</ol>
<ul class="simple">
<li><p>Utilize Bayesian neural networks or ensemble methods for better uncertainty estimation.</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>Model Interpretability:</p></li>
</ol>
<ul class="simple">
<li><p>Apply SHAP values or other explainability techniques to understand feature importance.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="credit-adjustment.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Credit Adjustment</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparable-company-analysis-market-multiples">1. Comparable Company Analysis (Market Multiples)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discounted-cash-flow-dcf-analysis">2. Discounted Cash Flow (DCF) Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#precedent-transactions-analysis">3. Precedent Transactions Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asset-based-valuation">4. Asset-Based Valuation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#earnings-capitalization-method">5. Earnings Capitalization Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#private-equity-valuation">6. Private Equity Valuation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rule-of-thumb-valuations">7. Rule of Thumb Valuations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consider-adjustments-for-private-firms">Consider Adjustments for Private Firms:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application">Application</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-components">Model Components</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lstm-for-time-series-data">LSTM for Time Series Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gnn-with-time-series">GNN with Time Series</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-caps-for-constraints">Compute Caps for Constraints</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-gnn-with-time-series-modified">Training the GNN with Time Series (Modified)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-validation">Model Validation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-loss-over-epochs">Plot Loss over Epochs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm-with-quantile-regression">LightGBM with Quantile Regression</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-constraints-adjusted">Applying Constraints (Adjusted)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#liquidity-discount-and-control-premium-adjustments">Liquidity Discount and Control Premium Adjustments</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#final-output">Final Output</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#possible-improvements">Possible Improvements</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Nguyen
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>