
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Conversion Model in Banks &#8212; Machine Learning in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=1a96265c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=c72506b3" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=1a96265c" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/styles/bootstrap.css?v=5340d9b1" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/styles/theme.css?v=a243ae73" />
    <link rel="stylesheet" type="text/css" href="_static/vendor/fontawesome/6.5.1/css/all.min.css?v=c786f70d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-NK1GQ8CXSN"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-NK1GQ8CXSN');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-NK1GQ8CXSN');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '75-conversion-model';</script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/copybutton_funcs.js?v=776a791e"></script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/language_data.js?v=e49ba422"></script>
    <script src="_static/searchtools.js?v=d19c4805"></script>
    <script src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/scripts/bootstrap.js?v=3d67b3b1"></script>
    <script src="_static/scripts/pydata-sphinx-theme.js?v=b2908668"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?v=95180707"></script>
    <link rel="canonical" href="https://mikenguyen13.github.io/mlpy/75-conversion-model.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Two-Sided Matching &amp; Ranking for Credit Cards" href="76-two-sided-matching.html" />
    <link rel="prev" title="Maximizing Profits with a Simple Integer Linear Program in Python" href="74-leads-allocation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Machine Learning in Python - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Machine Learning in Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction to Machine Learning and Artificial Intelligence
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="05-supervised-ml.html">Supervised Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-advanced_linear_regression.html">Advanced Linear Regression Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="15-matrix_factorization.html">Matrix Factorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="40-data-masking.html">Data Masking</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Industry Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="50-credit-score.html">Credit Score Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="51-min_risk.html">Risk Minimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="51-min_risk_amount.html">Risk Minimization with Overdue Balance</a></li>
<li class="toctree-l1"><a class="reference internal" href="52-credit-approval.html">Credit Approval</a></li>
<li class="toctree-l1"><a class="reference internal" href="53-credit-adjustment.html">Credit Adjustment</a></li>
<li class="toctree-l1"><a class="reference internal" href="54-firm-valuation.html">Firm Valuation</a></li>
<li class="toctree-l1"><a class="reference internal" href="55-financial_fraud.html">Financial Fraud Detection</a></li>



<li class="toctree-l1"><a class="reference internal" href="70-approximate-nearest-neighbors.html">Approximate Nearest Neighbors</a></li>
<li class="toctree-l1"><a class="reference internal" href="71-sim_dat_bandits.html">Multi-Armed Bandits</a></li>
<li class="toctree-l1"><a class="reference internal" href="72-data-anoy-geo.html">Data Anonymization Techniques for Geospatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="73-sample-splitting-time-series.html">Split Samples in Time Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="74-leads-allocation.html">Maximizing Profits with a Simple Integer Linear Program in Python</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Conversion Model in Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="76-two-sided-matching.html">Two-Sided Matching &amp; Ranking for Credit Cards</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mikenguyen13/mlpy" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mikenguyen13/mlpy/edit/main/75-conversion-model.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mikenguyen13/mlpy/issues/new?title=Issue%20on%20page%20%2F75-conversion-model.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/75-conversion-model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Conversion Model in Banks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-multiple-filters">Understanding the Multiple Filters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texting-filter-who-gets-contacted">Texting Filter – Who gets contacted?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-filter-who-actually-responds">Response Filter – Who actually responds?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bank-acceptance-filter-who-is-accepted-by-the-bank">Bank Acceptance Filter – Who is accepted by the bank?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-conceptual-multi-stage-modeling-approach">A Conceptual Multi-Stage Modeling Approach</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accounting-for-the-random-subset-and-non-random-subset">Accounting for the Random Subset and Non-Random Subset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-double-robust-strategies">Causal / Double-Robust Strategies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-explanation-of-the-multi-layer-strategy">Detailed Explanation of the Multi-Layer Strategy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#where-does-causal-uplift-fit-in">Where Does Causal “Uplift” Fit In?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together-in-python">Putting It All Together in Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-data-assumptions">Example Data Assumptions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-this-code-does">What This Code Does</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-corrects-the-multiple-filters">Why This Corrects the Multiple Filters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#important-nuances">Important Nuances</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ipw-reliance">IPW Reliance</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bank-acceptance">Bank Acceptance</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response-vs-application">Response vs. Application</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-subset">Random Subset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-one-stage-vs-multi-stage">(Optional) One-Stage vs. Multi-Stage</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-putting-it-into-practice">Conclusion (Putting It Into Practice)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#benefits-of-the-random-texted-group">Benefits of the Random Texted Group</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unbiased-baseline-for-causal-inference">Unbiased Baseline for Causal Inference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improved-propensity-score-estimation">Improved Propensity Score Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-and-model-evaluation">Validation and Model Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enhanced-uplift-estimation">Enhanced Uplift Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-confounding">Reduced Confounding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="conversion-model-in-banks">
<h1>Conversion Model in Banks<a class="headerlink" href="#conversion-model-in-banks" title="Link to this heading">#</a></h1>
<section id="understanding-the-multiple-filters">
<h2>Understanding the Multiple Filters<a class="headerlink" href="#understanding-the-multiple-filters" title="Link to this heading">#</a></h2>
<p>You have three main layers that determine whether someone ends up as a “final sign-up”:</p>
<section id="texting-filter-who-gets-contacted">
<h3>Texting Filter – Who gets contacted?<a class="headerlink" href="#texting-filter-who-gets-contacted" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Historically, you have a “propensity to answer” (or “likely to respond”) model. Anyone above a threshold gets texted; others do not.</p></li>
<li><p>However, you also maintain a random subset that bypasses your propensity threshold (they get texted at random).</p></li>
</ol>
<p>This yields two subpopulations:<br />
$<span class="math notranslate nohighlight">\(
T = 1 \quad (\text{texted, often chosen by your old model + a random group})  
\)</span><span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\(
T = 0 \quad (\text{not texted}).  
\)</span>$</p>
</section>
<hr class="docutils" />
<section id="response-filter-who-actually-responds">
<h3>Response Filter – Who actually responds?<a class="headerlink" href="#response-filter-who-actually-responds" title="Link to this heading">#</a></h3>
<p>Even among those texted (<span class="math notranslate nohighlight">\(T=1\)</span>), not everyone answers or applies. We observe “responded” or “applied” as a further selection step.</p>
</section>
<hr class="docutils" />
<section id="bank-acceptance-filter-who-is-accepted-by-the-bank">
<h3>Bank Acceptance Filter – Who is accepted by the bank?<a class="headerlink" href="#bank-acceptance-filter-who-is-accepted-by-the-bank" title="Link to this heading">#</a></h3>
<p>For those who do apply, the bank runs its own credit model. Only those who pass the bank’s credit threshold get truly onboarded, i.e., show up as “final sign-ups.”</p>
<p>You said you can turn off your credit filter, so we’ll ignore your side’s credit cutoff. But the bank’s filter is not under your control, so it’s effectively the last gate.</p>
<p>Thus, you only observe “final sign-up” for those who:</p>
<ul class="simple">
<li><p>Are texted (<span class="math notranslate nohighlight">\(T=1\)</span>)</p></li>
<li><p>Decide to respond/apply</p></li>
<li><p>Pass the bank’s filter</p></li>
</ul>
<p>Everyone else is either unobserved (not texted) or observed with an outcome of “did not sign up,” but that “did not sign up” might be due to not responding or due to being rejected by the bank.</p>
</section>
</section>
<hr class="docutils" />
<section id="a-conceptual-multi-stage-modeling-approach">
<h2>A Conceptual Multi-Stage Modeling Approach<a class="headerlink" href="#a-conceptual-multi-stage-modeling-approach" title="Link to this heading">#</a></h2>
<p>One way to tackle this is to model each stage separately, then combine. In essence:</p>
<ol class="arabic simple">
<li><p><strong>Stage A:</strong> Model the probability of being texted (<span class="math notranslate nohighlight">\(T=1\)</span>)<br />
This corrects for the fact that your older model (plus the random subset) determined who was texted.</p></li>
<li><p><strong>Stage B:</strong> Among those texted, model the probability of responding / applying.</p></li>
<li><p><strong>Stage C:</strong> Among those who respond, model the probability of being accepted by the bank.</p></li>
</ol>
<p>Finally, you can combine these probabilities to get an overall estimate of <span class="math notranslate nohighlight">\(\,P(\text{final sign-up} \mid X)\)</span>. Specifically:</p>
<div class="math notranslate nohighlight">
\[
P(\text{Texted} = 1 \mid X) \;(\text{Stage A}) \; \times \; P(\text{Respond} = 1 \mid \text{Texted} = 1, X) \;(\text{Stage B}) \; \times \; P(\text{BankAccept} = 1 \mid \text{Respond} = 1, X) \;(\text{Stage C}).
\]</div>
<p>However, in many marketing contexts, you have control over <strong>Stage A</strong> going forward (you can choose to text or not). So your real question might be:</p>
<blockquote>
<div><p>“If I do text this person, what is the probability they end up a final sign-up?”</p>
</div></blockquote>
<p>Then, the formula simplifies to:</p>
<div class="math notranslate nohighlight">
\[
P(\text{final sign-up} \mid \text{Texted} = 1, X) = P(\text{Respond} = 1 \mid X) \times P(\text{BankAccept} = 1 \mid \text{Respond} = 1, X).
\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P(\text{Respond} = 1 \mid X)\)</span> (Stage B) is the “likelihood they answer/apply if texted.”</p></li>
<li><p><span class="math notranslate nohighlight">\(P(\text{BankAccept} = 1 \mid \text{Respond} = 1, X)\)</span> (Stage C) is the “likelihood the bank accepts them if they do apply.”</p></li>
</ul>
<hr class="docutils" />
<section id="accounting-for-the-random-subset-and-non-random-subset">
<h3>Accounting for the Random Subset and Non-Random Subset<a class="headerlink" href="#accounting-for-the-random-subset-and-non-random-subset" title="Link to this heading">#</a></h3>
<p>Because your historical texting was mostly guided by a propensity model, you only see responses for the subset that got texted. This is selection bias.</p>
<p>Fortunately, you also have a random group that was texted purely at random, bypassing your old model. <strong>This random group is crucial</strong> to estimate the true relationship between <span class="math notranslate nohighlight">\(X\)</span> and “likelihood of responding,” free from the old model’s bias.</p>
<p>Similarly, for bank acceptance, you only observe acceptance decisions for those who responded. Another selection. But you do see accept/reject outcomes among that subset, so you can approximate the bank’s credit filter from that data.</p>
</section>
</section>
<hr class="docutils" />
<section id="causal-double-robust-strategies">
<h2>Causal / Double-Robust Strategies<a class="headerlink" href="#causal-double-robust-strategies" title="Link to this heading">#</a></h2>
<p>To correct for these multiple selection steps, you can use a combination of:</p>
<ul class="simple">
<li><p><strong>Inverse Probability Weighting (IPW)</strong></p>
<ul>
<li><p>Estimate the probability of each filtering step. Weight or “rebalance” the data so that it reflects the entire population.</p></li>
</ul>
</li>
<li><p><strong>Heckman 2-Stage or Double-Robust (DR) Learners</strong></p>
<ul>
<li><p>Popular in econometrics or libraries like <code class="docutils literal notranslate"><span class="pre">econml</span></code>.</p></li>
<li><p>DR Learners can handle partial observability (some people not texted, some texted but no response, etc.) by modeling both the outcome and the selection process.</p></li>
</ul>
</li>
</ul>
<p><strong>Key</strong>: Your random subset helps you build or validate these models, because randomization ensures at least some fraction of every type of <span class="math notranslate nohighlight">\(X\)</span> is texted, letting you estimate the true patterns.</p>
</section>
<hr class="docutils" />
<section id="detailed-explanation-of-the-multi-layer-strategy">
<h2>Detailed Explanation of the Multi-Layer Strategy<a class="headerlink" href="#detailed-explanation-of-the-multi-layer-strategy" title="Link to this heading">#</a></h2>
<p>Below is how you might implement a three-model approach:</p>
<ol class="arabic">
<li><p><strong>Model the Bank’s Acceptance (Stage C)</strong></p>
<ul class="simple">
<li><p><strong>Data</strong>: Among those who responded, you observe who got accepted vs. rejected by the bank.</p></li>
<li><p><strong>Features</strong>: (Credit-related info, demographics, maybe bureau data if you have it).</p></li>
<li><p>Train a classifier <span class="math notranslate nohighlight">\(\hat{m}_{\text{accept}}(X)\)</span> that predicts acceptance <span class="math notranslate nohighlight">\(\in \{0,1\}\)</span>. This approximates the bank’s “proprietary” threshold.</p></li>
</ul>
</li>
<li><p><strong>Model the Probability of Responding (Stage B)</strong></p>
<ul class="simple">
<li><p><strong>Data</strong>: Among those who were texted, label “1” if they responded, “0” otherwise.</p></li>
<li><p>Because your old texting strategy was not purely random, incorporate the randomly texted subset to correct bias. Specifically:</p>
<ul>
<li><p>Either do a propensity-score weighting for “who got texted” (to mimic a random scenario),</p></li>
<li><p>Or incorporate an indicator for random vs. non-random into the model.</p></li>
</ul>
</li>
<li><p>The result: <span class="math notranslate nohighlight">\(\hat{m}_{\text{respond}}(X) = P(\text{Respond}=1 \mid \text{Texted}=1, X)\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Combine for “If Texted” Probability</strong><br />
$<span class="math notranslate nohighlight">\(
P(\text{final sign-up} \mid \text{Texted}=1, X) = \hat{m}_{\text{respond}}(X) \times \hat{m}_{\text{accept}}(X).
\)</span>$</p>
<p>This is your key final metric: if I text this person, what’s the chance they end up fully signed up?</p>
</li>
<li><p><strong>Rank or Threshold</strong><br />
Once you have an estimate of <span class="math notranslate nohighlight">\(P(\text{final sign-up} \mid \text{Texted}=1, X)\)</span> for each potential lead, you can sort them in descending order and choose how many to text (depending on your budget or capacity).</p></li>
</ol>
<hr class="docutils" />
<section id="where-does-causal-uplift-fit-in">
<h3>Where Does Causal “Uplift” Fit In?<a class="headerlink" href="#where-does-causal-uplift-fit-in" title="Link to this heading">#</a></h3>
<p>If you also want the incremental effect—i.e., the difference in outcome if text vs. not text—then you need a method that models both scenarios:</p>
<div class="math notranslate nohighlight">
\[
\tau(X) = P(\text{final}=1 \mid T=1, X) \;-\; P(\text{final}=1 \mid T=0, X).
\]</div>
<p>For <span class="math notranslate nohighlight">\(P(\text{final}=1 \mid T=0, X)\)</span>, you might have a random “no text” group for comparison.</p>
<p>If your random subset includes both “text” and “no text” for a portion of your population, you can do an uplift model or a DR Learner from <code class="docutils literal notranslate"><span class="pre">econml</span></code> to estimate <span class="math notranslate nohighlight">\(\tau(X)\)</span>.</p>
<p>However, in practice, many marketing teams focus on “What is the predicted final sign-up probability if texted?” to decide who to contact.</p>
</section>
</section>
<hr class="docutils" />
<section id="putting-it-all-together-in-python">
<h2>Putting It All Together in Python<a class="headerlink" href="#putting-it-all-together-in-python" title="Link to this heading">#</a></h2>
<p>Below is a more detailed code snippet illustrating a two-step approach (respond + accept) while also correcting for non-random texting. We’ll outline the logic rather than just a minimal code—this should help you see how each filter is modeled.</p>
<p><strong>Important</strong>: This is not a copy-paste final solution. It’s a template showing how you might structure a multi-stage approach with Python libraries like scikit-learn. You will adjust data columns, hyperparameters, etc.</p>
<hr class="docutils" />
<section id="example-data-assumptions">
<h3>Example Data Assumptions<a class="headerlink" href="#example-data-assumptions" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code> has columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">texted</span></code>: 1 if the individual was texted, 0 if not.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">responded</span></code>: 1 if the individual applied or responded, 0 if not (only makes sense if <code class="docutils literal notranslate"><span class="pre">texted=1</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">accepted</span></code>: 1 if the bank accepted them, 0 if rejected (only makes sense if <code class="docutils literal notranslate"><span class="pre">responded=1</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">features...</span></code>: your input features known before deciding to text.</p></li>
<li><p>A special column <code class="docutils literal notranslate"><span class="pre">random_group</span></code> (1 if in the random texting subset, 0 otherwise) may exist. This can help you correct for your old texting model’s bias.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="c1"># For reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 1. SIMULATE SYNTHETIC DATA</span>
<span class="c1">###############################################################################</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># number of individuals</span>

<span class="c1"># Generate 5 numeric features (X1 through X5)</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">X3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">X4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">X5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># Create a DataFrame with these features</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;X1&#39;</span><span class="p">:</span> <span class="n">X1</span><span class="p">,</span>
    <span class="s1">&#39;X2&#39;</span><span class="p">:</span> <span class="n">X2</span><span class="p">,</span>
    <span class="s1">&#39;X3&#39;</span><span class="p">:</span> <span class="n">X3</span><span class="p">,</span>
    <span class="s1">&#39;X4&#39;</span><span class="p">:</span> <span class="n">X4</span><span class="p">,</span>
    <span class="s1">&#39;X5&#39;</span><span class="p">:</span> <span class="n">X5</span>
<span class="p">})</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 1.1 Create a &quot;random_group&quot; indicator (20% of individuals)</span>
<span class="c1">###############################################################################</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;random_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.20</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 2. SIMULATE TEXTING (Stage A)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># For individuals NOT in the random group, an &quot;old model&quot; decides who to text.</span>
<span class="c1"># For those in the random group, we text them with a fixed 50% probability.</span>
<span class="c1">###############################################################################</span>
<span class="k">def</span><span class="w"> </span><span class="nf">old_model_prob</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="c1"># A simple logistic function based on X1 and X2</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)))</span>

<span class="c1"># Compute the old-model probability for each individual</span>
<span class="n">old_probs</span> <span class="o">=</span> <span class="n">old_model_prob</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;X1&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X2&#39;</span><span class="p">])</span>

<span class="c1"># Decide who is texted:</span>
<span class="n">texted</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;random_group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># For random group: 50% chance</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.50</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Otherwise, follow the old model&#39;s probability</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">old_probs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">texted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;texted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">texted</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 3. SIMULATE RESPONSE (Stage B)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Only those who are texted can respond.</span>
<span class="c1"># We simulate the response probability using features X3 and X4.</span>
<span class="c1">###############################################################################</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prob_respond</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">x3</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">x4</span><span class="p">)))</span>

<span class="c1"># Initialize an array for responses</span>
<span class="n">responded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;texted&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">prob_respond</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;X3&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;X4&#39;</span><span class="p">])</span>
        <span class="c1"># Convert the boolean outcome to int (1 if responded, 0 otherwise)</span>
        <span class="n">responded</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">responded</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Cannot respond if not texted</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;responded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">responded</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 4. SIMULATE BANK ACCEPTANCE (Stage C)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Among those who responded, simulate bank acceptance based on X2 and X5.</span>
<span class="c1">###############################################################################</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prob_accept</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x5</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">x5</span><span class="p">)))</span>

<span class="n">accepted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;responded&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">prob_accept</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;X2&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;X5&#39;</span><span class="p">])</span>
        <span class="n">accepted</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">accepted</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Cannot be accepted if not responded</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accepted</span>

<span class="c1"># Print overall counts for a quick check</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number texted:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;texted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number responded:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;responded&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number accepted:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 5. MULTI-STAGE MODELING TO CORRECT FOR SELECTION BIAS</span>
<span class="c1">###############################################################################</span>
<span class="c1"># Our goal: estimate P(final sign-up | texted, X) = P(respond | texted, X) * P(accept | responded, X)</span>
<span class="c1">#</span>
<span class="c1"># To correct for the fact that historical texting was non-random,</span>
<span class="c1"># we first model the probability of being texted using all data,</span>
<span class="c1"># then use IPW to reweight the response model.</span>

<span class="c1"># 5.1 Define the feature set (include the random_group indicator)</span>
<span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="s1">&#39;X2&#39;</span><span class="p">,</span> <span class="s1">&#39;X3&#39;</span><span class="p">,</span> <span class="s1">&#39;X4&#39;</span><span class="p">,</span> <span class="s1">&#39;X5&#39;</span><span class="p">,</span> <span class="s1">&#39;random_group&#39;</span><span class="p">]</span>
<span class="n">X_all</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span>

<span class="c1"># ---------------------------------------------------------------------------</span>
<span class="c1"># Optional: Model the &quot;texted&quot; decision to compute propensity scores.</span>
<span class="c1"># This approximates P(texted=1 | X) based on historical data.</span>
<span class="c1"># ---------------------------------------------------------------------------</span>
<span class="n">model_texted</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">model_texted</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_all</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;texted&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;propensity_texted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_texted</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_all</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># 5.2 Model &quot;responded&quot; among those texted, using IPW to correct for non-random texting.</span>
<span class="n">df_texted</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;texted&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_texted</span> <span class="o">=</span> <span class="n">df_texted</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span>
<span class="n">y_respond</span> <span class="o">=</span> <span class="n">df_texted</span><span class="p">[</span><span class="s1">&#39;responded&#39;</span><span class="p">]</span>

<span class="c1"># IPW weights: w = 1 / P(texted=1 | X)</span>
<span class="n">df_texted</span><span class="p">[</span><span class="s1">&#39;weight_ipw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">df_texted</span><span class="p">[</span><span class="s1">&#39;propensity_texted&#39;</span><span class="p">]</span>

<span class="n">model_respond</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model_respond</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_texted</span><span class="p">,</span> <span class="n">y_respond</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">df_texted</span><span class="p">[</span><span class="s1">&#39;weight_ipw&#39;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">predict_respond_if_texted</span><span class="p">(</span><span class="n">X_new</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model_respond</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_new</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># 5.3 Model &quot;accepted&quot; among those who responded.</span>
<span class="n">df_responded</span> <span class="o">=</span> <span class="n">df_texted</span><span class="p">[</span><span class="n">df_texted</span><span class="p">[</span><span class="s1">&#39;responded&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_responded</span> <span class="o">=</span> <span class="n">df_responded</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span>
<span class="n">y_accepted</span> <span class="o">=</span> <span class="n">df_responded</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">]</span>

<span class="n">model_accept</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model_accept</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_responded</span><span class="p">,</span> <span class="n">y_accepted</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">predict_bank_accept</span><span class="p">(</span><span class="n">X_new</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model_accept</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_new</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># 5.4 Combine the two probabilities:</span>
<span class="c1"># Final sign-up probability if texted = P(respond | texted, X) * P(accept | responded, X)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">predict_final_if_texted</span><span class="p">(</span><span class="n">X_new</span><span class="p">):</span>
    <span class="n">p_resp</span> <span class="o">=</span> <span class="n">predict_respond_if_texted</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
    <span class="n">p_acc</span> <span class="o">=</span> <span class="n">predict_bank_accept</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_resp</span> <span class="o">*</span> <span class="n">p_acc</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;pred_final_if_texted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict_final_if_texted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">])</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 6. RANK INDIVIDUALS BY FINAL PREDICTION</span>
<span class="c1">###############################################################################</span>
<span class="n">df_ranked</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pred_final_if_texted&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Display the top 10 individuals by predicted final sign-up probability</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 individuals (texted, responded, accepted, predicted final probability):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_ranked</span><span class="p">[[</span><span class="s1">&#39;texted&#39;</span><span class="p">,</span><span class="s1">&#39;responded&#39;</span><span class="p">,</span><span class="s1">&#39;accepted&#39;</span><span class="p">,</span><span class="s1">&#39;pred_final_if_texted&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="c1">###############################################################################</span>
<span class="c1"># 7. QUICK EVALUATION: Compare Acceptance Rates in Top vs. Bottom Deciles</span>
<span class="c1">###############################################################################</span>
<span class="n">decile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_ranked</span><span class="p">))</span>
<span class="n">top_decile</span> <span class="o">=</span> <span class="n">df_ranked</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">decile</span><span class="p">)</span>
<span class="n">bottom_decile</span> <span class="o">=</span> <span class="n">df_ranked</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">decile</span><span class="p">)</span>

<span class="n">actual_conv_top</span> <span class="o">=</span> <span class="n">top_decile</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">actual_conv_bottom</span> <span class="o">=</span> <span class="n">bottom_decile</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top decile actual acceptance rate: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual_conv_top</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bottom decile actual acceptance rate: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual_conv_bottom</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number texted: 3040
Number responded: 1278
Number accepted: 678
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 10 individuals (texted, responded, accepted, predicted final probability):
      texted  responded  accepted  pred_final_if_texted
1475       1          1         1                0.9114
1155       1          1         1                0.9000
145        1          1         1                0.8827
3187       1          1         1                0.8640
4458       1          1         1                0.8633
4828       1          1         1                0.8556
4055       1          1         1                0.8556
770        1          1         1                0.8554
2390       1          1         1                0.8554
4605       1          1         1                0.8550

Top decile actual acceptance rate: 0.996
Bottom decile actual acceptance rate: 0.000
</pre></div>
</div>
</div>
</div>
</section>
<section id="what-this-code-does">
<h3>What This Code Does<a class="headerlink" href="#what-this-code-does" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>(Optional) Stage A</strong>: Learns how your old model decided who to text. We then compute each individual’s “propensity to be texted” to do IPW (if needed).</p></li>
<li><p><strong>Stage B</strong>: Restricts to historically texted people, trains a response model (<code class="docutils literal notranslate"><span class="pre">model_respond</span></code>), and uses IPW to partially correct for the non-random texting.</p></li>
<li><p><strong>Stage C</strong>: Among responders, trains a bank acceptance model (<code class="docutils literal notranslate"><span class="pre">model_accept</span></code>), approximating the bank’s filter.</p></li>
</ul>
<p><strong>Combine</strong>: For any new individual, we estimate</p>
<div class="math notranslate nohighlight">
\[
P(\text{final} \mid \text{texted}=1, X) = P(\text{respond}=1 \mid X) \times P(\text{accept}=1 \mid X).
\]</div>
<p>We then sort or rank by that final probability to see who is truly most likely to end up signed up if they receive a text.</p>
</section>
<hr class="docutils" />
<section id="why-this-corrects-the-multiple-filters">
<h3>Why This Corrects the Multiple Filters<a class="headerlink" href="#why-this-corrects-the-multiple-filters" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>We only observe “responded=1” for <code class="docutils literal notranslate"><span class="pre">texted=1</span></code> people, so <strong>Stage B</strong> is conditioned on “texted=1.” We use IPW to handle that texting was not fully random.</p></li>
<li><p>We only observe “accepted=1” for <code class="docutils literal notranslate"><span class="pre">responded=1</span></code> people, so <strong>Stage C</strong> is conditioned on “responded=1.” We fit a bank acceptance model on that subset.</p></li>
</ul>
<p>By chaining these models, we produce an estimate of the final sign-up probability for anyone under the scenario “If we text them.”</p>
<p>This approach, in effect, deals with each selection layer. If you had further layers (e.g., your own credit filter, or further user actions), you could add more stages similarly.</p>
</section>
<hr class="docutils" />
<section id="important-nuances">
<h3>Important Nuances<a class="headerlink" href="#important-nuances" title="Link to this heading">#</a></h3>
<section id="ipw-reliance">
<h4>IPW Reliance<a class="headerlink" href="#ipw-reliance" title="Link to this heading">#</a></h4>
<p>In Stage B, we used 1 / propensity_to_be_texted as sample weights to address who historically got texted. If your random subset is large enough, you can build a robust model for “texted=1” vs. “not texted=0” that generalizes to the entire population.<br />
You can refine weighting strategies (e.g., trim or cap extreme weights).</p>
</section>
<section id="bank-acceptance">
<h4>Bank Acceptance<a class="headerlink" href="#bank-acceptance" title="Link to this heading">#</a></h4>
<p>We assume the bank acceptance model can be approximated from the data of people who responded. You do not see the bank’s internal process, but you observe who got accepted vs. not. This is typically enough to train a decent classifier.<br />
If the bank changes its rules, you must retrain periodically.</p>
</section>
<section id="response-vs-application">
<h4>Response vs. Application<a class="headerlink" href="#response-vs-application" title="Link to this heading">#</a></h4>
<p>“Response” might be “clicked link,” “started application,” or something similar. The key is that only a subset of texted individuals respond. That’s your second filter.<br />
Make sure your labeling is consistent with your actual funnel steps.</p>
</section>
<section id="random-subset">
<h4>Random Subset<a class="headerlink" href="#random-subset" title="Link to this heading">#</a></h4>
<p>The random subset is crucial for building an accurate stage B model. It ensures that you observe a variety of <span class="math notranslate nohighlight">\(X\)</span>-profiles who were texted, even if your old model would have excluded them.<br />
If your random subset is too small, you might face high variance, but it’s still better than having no randomization.</p>
</section>
<section id="optional-one-stage-vs-multi-stage">
<h4>(Optional) One-Stage vs. Multi-Stage<a class="headerlink" href="#optional-one-stage-vs-multi-stage" title="Link to this heading">#</a></h4>
<p>Instead of building separate models for response &amp; acceptance, you could do a single “final outcome” model—but you’d still have to correct for the fact you only see final outcomes for texted + responded + accepted.<br />
Some data scientists prefer Heckman selection or Double-Robust meta-learners (like <code class="docutils literal notranslate"><span class="pre">DRLearner</span></code> from <code class="docutils literal notranslate"><span class="pre">econml</span></code>) that attempt to unify everything. But conceptually, you still need to handle the multi-filter problem.</p>
</section>
</section>
<hr class="docutils" />
<section id="conclusion-putting-it-into-practice">
<h3>Conclusion (Putting It Into Practice)<a class="headerlink" href="#conclusion-putting-it-into-practice" title="Link to this heading">#</a></h3>
<p>By explicitly modeling each layer—especially the response stage and the bank acceptance stage—you correct the missing-data problem where you only observe final sign-ups for those who got texted and responded. The random subset is the anchor that lets you handle your older non-random texting rules. Then you can produce an accurate measure:</p>
<blockquote>
<div><p><strong>“If I text this person, what’s the probability they end up fully signed up (passed the bank’s filter, etc.)?”</strong></p>
</div></blockquote>
<p>Finally, you can rank potential leads by that probability and target the top group—thereby maximizing your conversions and dealing with the multi-layer selection bias.</p>
</section>
</section>
<section id="benefits-of-the-random-texted-group">
<h2>Benefits of the Random Texted Group<a class="headerlink" href="#benefits-of-the-random-texted-group" title="Link to this heading">#</a></h2>
<p>Beyond simply serving as a way to randomly determine who gets texted (i.e., a 50% chance for those in the random group), the <strong>random group provides several key benefits</strong>:</p>
<section id="unbiased-baseline-for-causal-inference">
<h3>Unbiased Baseline for Causal Inference<a class="headerlink" href="#unbiased-baseline-for-causal-inference" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The random group acts as a <strong>gold standard</strong> because it is <strong>not subject to the selection biases</strong> inherent in your older targeting model.</p></li>
<li><p>This <strong>unbiased sample</strong> helps you accurately estimate the <strong>true treatment effect (uplift)</strong> by providing a direct comparison between texted and non-texted individuals <strong>without the confounding influence of historical selection rules</strong>.</p></li>
</ul>
</section>
<section id="improved-propensity-score-estimation">
<h3>Improved Propensity Score Estimation<a class="headerlink" href="#improved-propensity-score-estimation" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>When you build models to estimate the <strong>propensity of being texted</strong> or the <strong>likelihood of responding</strong>, having a randomized subgroup allows you to <strong>calibrate these models more reliably</strong>.</p></li>
<li><p>The random group <strong>captures the natural variability</strong> in responses across all segments of your population, making your <strong>propensity score estimates (and any IPW corrections) more robust</strong>.</p></li>
</ul>
</section>
<section id="validation-and-model-evaluation">
<h3>Validation and Model Evaluation<a class="headerlink" href="#validation-and-model-evaluation" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The <strong>random group can be used as a validation set</strong> to check whether your models (for response, acceptance, or the overall uplift) are performing as expected.</p></li>
<li><p>If you compare outcomes in the random group against those <strong>predicted by your models</strong>, you get a clearer signal of how well your models generalize to the broader population.</p></li>
</ul>
</section>
<section id="enhanced-uplift-estimation">
<h3>Enhanced Uplift Estimation<a class="headerlink" href="#enhanced-uplift-estimation" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>In <strong>uplift modeling</strong> (estimating the incremental effect of texting), having a <strong>truly random assignment</strong> in part of your dataset helps you distinguish between:</p>
<ul>
<li><p>The <strong>natural propensity to convert</strong></p></li>
<li><p>The <strong>conversion that is actually caused by receiving a text</strong></p></li>
</ul>
</li>
<li><p>This leads to <strong>more precise targeting</strong>, as you can better isolate the <strong>incremental benefit of texting</strong> for different customer segments.</p></li>
</ul>
</section>
<section id="reduced-confounding">
<h3>Reduced Confounding<a class="headerlink" href="#reduced-confounding" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Because the random group is <strong>free from the biases</strong> introduced by the old propensity model, it helps <strong>reduce confounding</strong> when you combine the data to train your causal or double robust models.</p></li>
<li><p>This makes your estimates of <strong>treatment effect less susceptible to bias</strong> from unobserved factors that might influence both the <strong>decision to text</strong> and the <strong>outcome</strong>.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h3>
<p>The <strong>random group is not just a mechanism</strong> to decide who gets texted randomly—it also serves as an <strong>essential tool</strong> for:</p>
<ul class="simple">
<li><p><strong>Establishing a causal baseline</strong></p></li>
<li><p><strong>Improving the accuracy and robustness of your modeling efforts</strong></p></li>
<li><p><strong>Validating your estimated treatment effects</strong></p></li>
<li><p><strong>Reducing confounding bias in selection</strong></p></li>
<li><p><strong>Ensuring that targeting is based on the <strong>true incremental impact</strong> of texting, rather than artifacts of previous selection rules</strong></p></li>
</ul>
<p>These benefits are <strong>critical</strong> for making sure that when you <strong>target customers</strong>, you’re <strong>truly focusing on those who will benefit</strong> from receiving a text—thereby improving both <strong>conversion rates</strong> and the <strong>efficiency of your marketing spend</strong>.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="74-leads-allocation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Maximizing Profits with a Simple Integer Linear Program in Python</p>
      </div>
    </a>
    <a class="right-next"
       href="76-two-sided-matching.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Two-Sided Matching &amp; Ranking for Credit Cards</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-multiple-filters">Understanding the Multiple Filters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texting-filter-who-gets-contacted">Texting Filter – Who gets contacted?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-filter-who-actually-responds">Response Filter – Who actually responds?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bank-acceptance-filter-who-is-accepted-by-the-bank">Bank Acceptance Filter – Who is accepted by the bank?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-conceptual-multi-stage-modeling-approach">A Conceptual Multi-Stage Modeling Approach</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accounting-for-the-random-subset-and-non-random-subset">Accounting for the Random Subset and Non-Random Subset</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-double-robust-strategies">Causal / Double-Robust Strategies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-explanation-of-the-multi-layer-strategy">Detailed Explanation of the Multi-Layer Strategy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#where-does-causal-uplift-fit-in">Where Does Causal “Uplift” Fit In?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together-in-python">Putting It All Together in Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-data-assumptions">Example Data Assumptions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-this-code-does">What This Code Does</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-corrects-the-multiple-filters">Why This Corrects the Multiple Filters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#important-nuances">Important Nuances</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ipw-reliance">IPW Reliance</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bank-acceptance">Bank Acceptance</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response-vs-application">Response vs. Application</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-subset">Random Subset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-one-stage-vs-multi-stage">(Optional) One-Stage vs. Multi-Stage</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-putting-it-into-practice">Conclusion (Putting It Into Practice)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#benefits-of-the-random-texted-group">Benefits of the Random Texted Group</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unbiased-baseline-for-causal-inference">Unbiased Baseline for Causal Inference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improved-propensity-score-estimation">Improved Propensity Score Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-and-model-evaluation">Validation and Model Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enhanced-uplift-estimation">Enhanced Uplift Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-confounding">Reduced Confounding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Nguyen
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>